;зддддддддддддддддддддддддддддддддддддддддддддддддддд©
;Ё lumberjacks                                       Ё
;цддддддддддддддддддддддддддддддддддддддддддддддддддд╢
;Ё                                                   Ё
;Ё copyright (C) 2017 jeff panici                    Ё
;Ё https://nybbles.io                                Ё
;Ё                                                   Ё
;Ё                                                   Ё
;Ё                                                   Ё
;юддддддддддддддддддддддддддддддддддддддддддддддддддды

;зддддддддддддддддддддддддддддддддддддддддддддддддддд©
;Ё macros                                            Ё
;юддддддддддддддддддддддддддддддддддддддддддддддддддды
s$_defc macro
    db  1, #1
#em

s$_def macro
    db  #s1 - 2, #1
#em

s$_defq macro
    db  #s1, '#1'
#em

s$_resv macro
    db      #1
    db      #1 dup(020h)
#em

;зддддддддддддддддддддддддддддддддддддддддддддддддддд©
;Ё variables                                         Ё
;юддддддддддддддддддддддддддддддддддддддддддддддддддды
hex_chars:
    db  '0123456789ABCDEF'

;зддддддддддддддддддддддддддддддддддддддддддддддддддд©
;Ё _s$_cpy                                           Ё
;юддддддддддддддддддддддддддддддддддддддддддддддддддды
_s$_cpy:
    mov     bp, sp
    mov     cx, [bp + 2]
    mov     si, [bp + 4]
    mov     di, [bp + 6]
    mov     es, cs
    cld
l0: movsb
    loop    l0
    ret

s$_cpy macro
    push    bp, es, ax, cx, si, di
    push    #1, #2, #3
    call    _s$_cpy
    add     sp, 6
    pop     di, si, cx, ax, es, bp
#em

;зддддддддддддддддддддддддддддддддддддддддддддддддддд©
;Ё s$_dec2                                           Ё
;юддддддддддддддддддддддддддддддддддддддддддддддддддды
s$_dec2:
    push    es, ax
    mov     es, cs
    aam
    add     ax, '00'
    xchg    ah, al
    stosw
    pop     ax, es
    ret

;зддддддддддддддддддддддддддддддддддддддддддддддддддд©
;Ё s$_dec5                                           Ё
;юддддддддддддддддддддддддддддддддддддддддддддддддддды
s$_dec5:
    push    es, ax, bx, dx
    xchg    dx, ax
    mov     ax, '00'
    stosw
    stosw
    push    di
    mov     bx, 10
    std
l0: xchg    ax, dx
    xor     dx, dx
    div     bx
    xchg    dx, ax
    add     al, '0'
    stosb
    test    dx
    jnz     l0
    pop     di
    inc     di
    pop     dx, bx, ax, es
    cld
    ret

;зддддддддддддддддддддддддддддддддддддддддддддддддддд©
;Ё s$_hex2                                           Ё
;юддддддддддддддддддддддддддддддддддддддддддддддддддды
s$_hex2:
    push    bx
    lea     bx, hex_chars
    mov     ah, al
    shr     ah, 4
    and     al, 0fh
    xlat
    xchg    ah, al
    xlat
    xchg    ah, al
    mov     [di], ax
    pop     bx
    ret
