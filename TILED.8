;зддддддддддддддддддддддддддддддддддддддддддддддддддд©
;Ё banked                                            Ё
;цддддддддддддддддддддддддддддддддддддддддддддддддддд╢
;Ё                                                   Ё
;Ё copyright (C) 2017 jeff panici                    Ё
;Ё https://nybbles.io                                Ё
;Ё                                                   Ё
;Ё                                                   Ё
;Ё                                                   Ё
;юддддддддддддддддддддддддддддддддддддддддддддддддддды

;зддддддддддддддддддддддддддддддддддддддддддддддддддд©
;Ё constants                                         Ё
;юддддддддддддддддддддддддддддддддддддддддддддддддддды

;зддддддддддддддддддддддддддддддддддддддддддддддддддд©
;Ё variables                                         Ё
;юддддддддддддддддддддддддддддддддддддддддддддддддддды

;зддддддддддддддддддддддддддддддддддддддддддддддддддд©
;Ё _tiled_draw                                       Ё
;юддддддддддддддддддддддддддддддддддддддддддддддддддды
_tiled_draw:
    struc [bp]
                    dw ?
                    db ?
        te_pix_sz   db ?
                    db ?
        te_tile_sz  db ?
                    db ?
        te_pal      db ?
    ends

    mov     bp, sp
    vg_fbox 43 by 20, 128 by 128, 8 by 0
    vg_box  42 by 20, 128 by 128, 0 by 0
    mov     bh, 43
    mov     bl, 21
    mov     dh, te_pix_sz
    mov     dl, dh
    cs mov  ch, te_tile_sz
l0: cs mov  cl, te_tile_sz
l1: ds mov  al, [si]
    aam     16
    push    cx
    mov     ch, ah
    cs mov  cl, te_pal
    vg_fbox bx, dx, cx
    add     bh, dh
    inc     bh
    mov     ch, al
    vg_fbox bx, dx, cx
    add     bh, dh
    inc     bh
    pop     cx
    sub     cl, 2
    cmp     cl, 0
    jne     l1
    add     bl, dl
    inc     bl
    mov     bh, 43
    dec     ch
    jnz     l0
    ret

te_draw macro
    push    bp, ax, bx, cx, dx
    push    #3, #2, #1
    call    _tiled_draw
    add     sp, 6
    pop     dx, cx, bx, ax, bp
#em

